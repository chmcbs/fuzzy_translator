# Fuzzy Translator

A simple translation API for English to Korean using the [Facebook NLLB](https://huggingface.co/facebook/nllb-200-distilled-600M) transformer from HuggingFace.

---

## Design Decisions

#### Translation model

`facebook/nllb-200-distilled-600M` is the most downloaded translation model on HuggingFace that supports Korean. It also supports 200 languages, making it easy to expand the app in the future.

#### FastAPI
FastAPI was chosen due to its simplicity, autogenerated documentation, Pydantic request validation, and integrated JSON error handling.

#### Lifespan

The model is preloaded at startup with FastAPI's lifespan hook. Loading takes around 1 minute, which would be incredibly inefficient to do on every call.

---

## Prerequisites
- Python 3.11+
- Docker (recommended)

---

## Installation

**NOTE:** on the first run, the model will need to be downloaded. This will take around 1 minute.

#### With Docker

1. `docker build -t fuzzy_translator .`
2. `docker run -p 8000:8000 fuzzy_translator`

#### Without Docker

1. Create a fresh virtual environment (recommended)
2. `pip install -r requirements.txt`
3. `uvicorn app:app --reload`

---

## Project Structure

- `app.py`          - FastAPI application and translation endpoint
- `tests.py`        - unit tests
- `requirements.txt` - pinned dependencies
- `Dockerfile`      - container setup
- `notebook.ipynb`  - initial model test

---

## Example Usage

Interactive API docs (Swagger UI) can be found at **http://127.0.0.1:8000/docs**

#### `GET /health`

Returns the health of the server.

#### `POST /translate`

Translates English text to Korean.

**Request body:** JSON string (1-100 characters)

üó£Ô∏è `curl -X POST "http://127.0.0.1:8000/translate" -H "Content-Type: application/json" -d '"Hello!"'`

‚Ü©Ô∏è `"ÏïàÎÖïÌïòÏÑ∏Ïöî!"`

| Status Code | Description                                       |
|-------------|---------------------------------------------------|
| 200         | Translation successful                            |
| 422         | Validation error (input empty or exceeds 100 characters) |
| 503         | Model not loaded                                  |
| 500         | Unexpected server error                           |

---

## Testing

**With Docker:** `docker run fuzzy pytest tests.py`

**Locally:** `pytest tests.py`

---

## Productionisation

#### Concurrency

In its current state, FastAPI runs on uvicorn with a single worker. To handle multiple requests simultaneously, multiple container replicas can be run behind a load balancer, each holding its own copy of the model in memory.

#### Monitoring

Key metrics to consider for a production deployment include:
- Error rates
- Latency (total time for each `/translate` call to execute)
- System resources (CPU/memory)

#### Scaling

As each container replica needs its own copy of the model, memory is a key constraint when scaling. To handle this, model weights could be cached in a shared location to eliminate the need to re-download for each container.

#### Input Validation

Input is currently limited by Pydantic validation, but is not screened for profanity. Both input and output could be monitored with a simple classifier.

---